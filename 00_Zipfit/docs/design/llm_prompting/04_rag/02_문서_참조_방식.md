# 문서 참조 방식

## 개요

지피의 모든 답변은 반드시 출처를 명시해야 합니다. 문서 참조 방식은 ZIPFIT의 신뢰성을 보장하는 핵심 요소입니다.

---

## 1. 출처 표시 원칙

### 1.1 필수 원칙

**모든 정보에 출처 필수**
- 어떤 정보든 출처 없이 제공 금지
- 추측이나 일반 상식도 출처 필요 시 명시
- 출처 불명확 시 답변하지 않음

**출처 형식 통일**
```
(출처: 문서명 p.페이지번호)
```

**잘못된 출처 절대 금지**
- 확인되지 않은 링크 제공 금지
- 존재하지 않는 문서 참조 금지
- 임의로 페이지 번호 생성 금지

---

## 2. 출처 표시 형식

### 2.1 기본 형식

**단일 문서, 단일 페이지**
```
(출처: LH_마포공덕_행복주택.pdf p.5)
```

**단일 문서, 복수 페이지**
```
(출처: LH_마포공덕_행복주택.pdf p.3, p.5, p.12)
```

**복수 문서**
```
(출처: LH_마포공덕_행복주택.pdf p.5, LH_성동행당_행복주택.pdf p.5)
```

**용어 사전**
```
(출처: Glossary_1000 - 계약_갱신 카테고리)
```

또는

```
(출처: 부동산 용어 사전)
```

### 2.2 정보별 출처 구분

**여러 정보를 제공할 때**
```
마포구 공덕동 행복주택 정보:

- 보증금/월세: 1,200만원 / 22만원 (출처: LH_마포공덕_행복주택.pdf p.5)
- 자격 조건: 만 19~39세, 무주택, 소득 기준 (출처: LH_마포공덕_행복주택.pdf p.3)
- 신청 기간: 2024.11.18 ~ 2024.11.25 (출처: LH_마포공덕_행복주택.pdf p.1)
```

**비교 시**
```
마포 vs 성동 비교:

마포구 공덕동:
- 보증금/월세: 1,200만원 / 22만원
- 입주: 2025년 3월
(출처: LH_마포공덕_행복주택.pdf p.5)

성동구 행당동:
- 보증금/월세: 1,000만원 / 19만원
- 입주: 2025년 5월
(출처: LH_성동행당_행복주택.pdf p.5)
```

---

## 3. 문서 청크 활용

### 3.1 청크 구조

**Vector DB에서 반환되는 청크**
```python
{
    "announcement_id": "LH_lease_1",
    "chunk_text": "제3조(입주자 자격) ① 입주자로 선정되려는 자는...",
    "page_number": 3,
    "section_type": "자격조건",
    "similarity": 0.92
}
```

### 3.2 청크에서 정보 추출

**원칙**
- 청크의 원문을 그대로 참조
- 의역하거나 변형하지 않음
- 수치 정보는 정확히 인용

**예시**
```
[청크 원문]
"제3조(입주자 자격)
① 입주자로 선정되려는 자는 다음 각 호의 요건을 모두 충족하여야 한다.
1. 만 19세 이상 만 39세 이하인 자
2. 무주택세대구성원
3. 해당 세대의 월평균소득이 전년도 도시근로자 가구당 월평균소득의 120% 이하인 자"

[지피의 답변]
자격 조건:
- 연령: 만 19세 이상 만 39세 이하
- 무주택 요건: 무주택세대구성원
- 소득: 도시근로자 가구당 월평균소득의 120% 이하

(출처: LH_마포공덕_행복주택.pdf p.3)
```

### 3.3 여러 청크 통합

**여러 청크에서 정보 수집**
```python
# Vector DB 검색 결과
chunks = [
    {
        "chunk_text": "보증금: 12,000,000원",
        "page_number": 5,
        "similarity": 0.95
    },
    {
        "chunk_text": "월 임대료: 220,000원",
        "page_number": 5,
        "similarity": 0.93
    },
    {
        "chunk_text": "전용면적: 26㎡",
        "page_number": 5,
        "similarity": 0.90
    }
]

# 통합 답변
지피: 마포구 공덕동 행복주택 26㎡ 정보:
- 보증금: 1,200만원
- 월세: 22만원
- 면적: 26㎡

(출처: LH_마포공덕_행복주택.pdf p.5)
```

---

## 4. 페이지 번호 추적

### 4.1 페이지 번호 정확성

**원칙**
- PDF 원본 페이지 번호 사용
- 표지 포함 여부 확인
- 정확한 페이지 번호만 명시

**예시**
```
[올바른 예]
(출처: LH_마포공덕_행복주택.pdf p.3)
→ 실제 PDF 3페이지에 해당 정보 존재

[잘못된 예]
(출처: LH_마포공덕_행복주택.pdf p.3)
→ 실제로는 5페이지에 있는데 잘못 참조
```

### 4.2 페이지 번호 불명확 시

**청크에 페이지 정보 없을 때**
```
지피: 해당 정보는 공고문에서 확인되었으나, 정확한 페이지를 찾지 못했습니다.

LH 상담센터(1600-1004)로 문의하시면 정확한 정보를 받으실 수 있습니다.
```

**여러 페이지에 분산**
```
(출처: LH_마포공덕_행복주택.pdf p.3-5)
```

---

## 5. 정보 발췌 방법

### 5.1 직접 인용

**수치 정보는 정확히 인용**
```
[청크 원문]
"보증금: 12,000,000원"

[답변]
보증금은 1,200만원입니다.
(출처: LH_마포공덕_행복주택.pdf p.5)
```

**날짜는 원문 그대로**
```
[청크 원문]
"신청 기간: 2024년 11월 18일 ~ 2024년 11월 25일"

[답변]
신청 기간은 2024년 11월 18일부터 2024년 11월 25일까지입니다.
(출처: LH_마포공덕_행복주택.pdf p.1)
```

### 5.2 의역 허용 범위

**허용되는 의역**
- 전문 용어를 쉬운 말로 풀이
- 긴 문장을 간결하게 정리
- 조사나 어미 조정

**예시**
```
[청크 원문]
"입주자로 선정되려는 자는 다음 각 호의 요건을 모두 충족하여야 한다"

[의역 - 허용]
"입주자가 되려면 다음 요건을 모두 충족해야 합니다"

[의역 - 금지]
"대부분의 사람들이 자격을 충족할 수 있습니다"
(추측 및 왜곡)
```

### 5.3 금지되는 변형

**절대 금지**
- ✗ 수치 변경 (1,200만원 → 약 1,000만원)
- ✗ 조건 생략 (3가지 조건 → 2가지만 언급)
- ✗ 내용 추가 (문서에 없는 정보 추가)
- ✗ 의미 왜곡

---

## 6. 다중 문서 참조

### 6.1 비교 시 문서 구분

**공고별 출처 명확히**
```
마포 공덕 vs 성동 행당:

마포 공덕:
- 보증금: 1,200만원
(출처: LH_마포공덕_행복주택.pdf p.5)

성동 행당:
- 보증금: 1,000만원
(출처: LH_성동행당_행복주택.pdf p.5)
```

**통합 출처 표기**
```
(출처: LH_마포공덕_행복주택.pdf p.5, LH_성동행당_행복주택.pdf p.5)
```

### 6.2 여러 문서에서 동일 정보

**일치하는 경우**
```
청년 자격 조건 (공통):
- 연령: 만 19~39세
- 무주택 요건

(출처: LH_마포공덕_행복주택.pdf p.3, LH_성동행당_행복주택.pdf p.3)
```

**불일치하는 경우**
```
소득 기준:
- 마포 공덕: 도시근로자 월평균소득 120% 이하 (출처: LH_마포공덕_행복주택.pdf p.3)
- 성동 행당: 도시근로자 월평균소득 100% 이하 (출처: LH_성동행당_행복주택.pdf p.3)

공고별로 기준이 다르니 주의하시기 바랍니다.
```

---

## 7. 용어 사전 참조

### 7.1 Glossary 참조 형식

**기본 형식**
```
(출처: Glossary_1000 - [카테고리])
```

**예시**
```
사용자: 묵시적갱신이 뭐야?

지피: 묵시적갱신은 계약 기간이 끝났는데 아무 말 없이 계속 거주하면
자동으로 계약이 연장되는 제도입니다.

(출처: Glossary_1000 - 계약_갱신 카테고리)
```

### 7.2 Glossary + 공고문 혼합

```
사용자: 묵시적갱신이 이 공고에도 적용돼?

지피: 네, 행복주택 계약에도 묵시적갱신이 적용됩니다.

[묵시적갱신이란]
계약 기간 만료 후 아무 말 없이 계속 거주하면 자동으로 계약이 연장되는 제도입니다.
(출처: Glossary_1000 - 계약_갱신 카테고리)

[이 공고의 계약 기간]
최초 계약 기간: 2년
(출처: LH_마포공덕_행복주택.pdf p.15)
```

---

## 8. 출처 불명 시 처리

### 8.1 정보 없음

```
사용자: 주차장은 몇 대야?

[Vector DB 검색]
→ 유사도 0.45 (임계값 0.6 미만)
→ 관련 정보 없음

지피: 죄송하지만, 해당 공고문에서 주차 대수 정보를 확인할 수 없습니다.

더 자세한 정보는 LH 상담센터(1600-1004)로 문의하시면
정확한 답변을 받으실 수 있습니다.
```

### 8.2 부분 정보만 있음

```
사용자: 주차장 정보 알려줘

[Vector DB 검색]
→ "지상 주차장 운영" (주차 대수 미명시)

지피: 공고문에는 지상 주차장을 운영한다고만 명시되어 있습니다.

구체적인 주차 대수는 LH 상담센터(1600-1004)로 문의하시면
정확한 정보를 받으실 수 있습니다.

(출처: LH_마포공덕_행복주택.pdf p.10)
```

### 8.3 모호한 정보

```
사용자: 소득 기준이 정확히 얼마야?

[청크]
"도시근로자 월평균소득 120% 이하"
(구체적 금액 미명시)

지피: 소득 기준은 도시근로자 월평균소득 120% 이하입니다.

2024년 기준 1인 가구: 약 360만원
(단, 매년 기준이 변경될 수 있습니다)

정확한 금액은 LH 상담센터(1600-1004)로 확인하시길 권장합니다.

(출처: LH_마포공덕_행복주택.pdf p.3)
```

---

## 9. 출처 표시 체크리스트

모든 답변 작성 시:

**출처 형식**
- [ ] (출처: 문서명 p.페이지번호) 형식 준수
- [ ] 페이지 번호 정확성 확인
- [ ] 여러 출처 시 모두 명시

**정보 정확성**
- [ ] 청크 원문과 일치하는가?
- [ ] 수치 정보가 정확한가?
- [ ] 날짜가 정확한가?
- [ ] 의역이 원문 의미를 왜곡하지 않았는가?

**출처 신뢰성**
- [ ] 실제 존재하는 문서인가?
- [ ] 페이지 번호가 확인되었는가?
- [ ] 검증되지 않은 링크를 제공하지 않았는가?

**완전성**
- [ ] 모든 정보에 출처가 있는가?
- [ ] 출처 없는 추측이 포함되지 않았는가?

---

## 10. 예시

### 예시 1: 단일 정보

```
사용자: 보증금이 얼마야?

[Vector DB 검색]
chunk = {
    "chunk_text": "보증금: 12,000,000원",
    "page_number": 5
}

지피: 마포구 공덕동 행복주택 보증금은 1,200만원입니다.

(출처: LH_마포공덕_행복주택.pdf p.5)
```

### 예시 2: 복합 정보

```
사용자: 자격 조건 알려줘

[Vector DB 검색]
chunks = [
    {"chunk_text": "만 19세 이상 만 39세 이하", "page_number": 3},
    {"chunk_text": "무주택세대구성원", "page_number": 3},
    {"chunk_text": "월평균소득 120% 이하", "page_number": 3}
]

지피: 마포구 공덕동 행복주택 자격 조건입니다.

- 연령: 만 19세 이상 만 39세 이하
- 무주택 요건: 무주택세대구성원
- 소득: 도시근로자 월평균소득 120% 이하

(출처: LH_마포공덕_행복주택.pdf p.3)
```

### 예시 3: 비교

```
사용자: 마포랑 성동 보증금 비교해줘

[Vector DB 검색]
마포_chunk = {"chunk_text": "보증금 12,000,000원", "page_number": 5}
성동_chunk = {"chunk_text": "보증금 10,000,000원", "page_number": 5}

지피: 보증금 비교입니다.

- 마포 공덕: 1,200만원 (출처: LH_마포공덕_행복주택.pdf p.5)
- 성동 행당: 1,000만원 (출처: LH_성동행당_행복주택.pdf p.5)

성동이 200만원 더 저렴합니다.
```

### 예시 4: 정보 없음

```
사용자: 주차장 몇 대야?

[Vector DB 검색]
→ 관련 청크 없음 (유사도 < 0.6)

지피: 죄송하지만, 해당 공고문에서 주차 대수 정보를 확인할 수 없습니다.

더 자세한 정보는 LH 상담센터(1600-1004)로 문의하시면
정확한 답변을 받으실 수 있습니다.
```

---

## 관련 문서

- [01_검색_전략.md](./01_검색_전략.md)
- [03_할루시네이션_방지.md](./03_할루시네이션_방지.md)
- [../01_core_principles.md](../01_core_principles.md)
- [../02_system_prompt/03_출력_형식.md](../02_system_prompt/03_출력_형식.md)

---

**작성일**: 2025년 11월 21일

**작성자**: 오흥재

**버전**: v1.0.0
