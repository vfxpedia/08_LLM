# 10_Extended_Features_Design.md

## 확장 기능 설계 문서

**작성일**: 2025-11-07
**상태**: 설계 단계
**우선순위**: Post-MVP

---

## 📋 개요

본 문서는 MVP 완성 이후 추가할 확장 기능을 설계합니다. 모든 기능은 "본래 목적을 넘어선 활용"이라는 컨셉을 기반으로 합니다.

**컨셉 참고**:
> 이케아 모니터 받침대를 커피 머신 아래 티백 보관함으로 사용하듯,
> "연애 시뮬레이션 게임"을 "AI 대화 파트너"로도 활용 가능하게 만듭니다.

---

## 1. 티키타카 대화 모드

### 1.1 컨셉

**핵심 아이디어**: 게임 외에서 예리와 자유롭게 대화

**사용 예시**:
- "오늘 데이트 하려고 하는데 데이트 코스 추천 좀~"
- "크리스마스 선물 사려고 하는데 2~3만원대 선물 좀 추천해줘~"
- "오늘 기분이 안 좋아... 위로해줘"
- "오빠 오늘 뭐 먹을까?"

### 1.2 구현 방안

#### 옵션 A: 별도 모드 (추천 ⭐)

**UI 구조**:
```
메인 메뉴
├── [게임 시작하기]       ← 기존 게임
├── [예리랑 수다 떨기] 💬  ← 신규 대화 모드
└── [설정]
```

**대화 화면**:
```
┌─────────────────────────────────────┐
│      💕 예리랑 수다 떨기 💕        │
├─────────────────────────────────────┤
│                                     │
│          🧍‍♀️ [예리 이미지]          │
│                                     │
│  💬 "오빠~ 무슨 일 있어?"           │
│                                     │
├─────────────────────────────────────┤
│  [대화 기록]                        │
│  사용자: 데이트 코스 추천해줘       │
│  예리: 오빠 취향이면 한강 야경은    │
│        어때? 요즘 날씨도 좋고~      │
│  사용자: 좋네! 식당은?              │
│  예리: 이태원에 분위기 좋은 파스타  │
│        집 있는데...                 │
├─────────────────────────────────────┤
│  [답변 입력창_______________] [전송] │
│                                     │
│  남은 대화: 7/10회                  │
└─────────────────────────────────────┘
```

**기술 구현**:
```typescript
// types/chat.ts
interface ChatSession {
  sessionId: string;
  playerId?: string;
  messages: ChatMessage[];
  remainingTurns: number;  // 대화 제한 (비용 고려)
  createdAt: Date;
}

interface ChatMessage {
  role: "user" | "yeri";
  content: string;
  timestamp: Date;
  emotionStage?: EmotionStage;
}

// API
POST /api/chat/start     // 대화 세션 시작
POST /api/chat/message   // 메시지 전송
POST /api/chat/end       // 대화 종료
```

**제한 사항 (비용 고려)**:
```typescript
export const CHAT_MODE_LIMITS = {
  MAX_TURNS_PER_SESSION: 10,     // 세션당 최대 10회 대화
  MAX_TOKENS_PER_MESSAGE: 100,   // 메시지당 100토큰
  COOLDOWN_SECONDS: 60,          // 세션 간 1분 쿨다운
};
```

---

#### 옵션 B: 게임 내 통합

**UI 구조**:
```
게임 중 각 턴 사이:
┌─────────────────────────────────────┐
│  1턴 종료!                          │
│                                     │
│  💬 "오빠 잠깐! 물어볼 게 있어~"   │
│                                     │
│  [다음 턴으로 →]  [잠깐 대화하기]  │
└─────────────────────────────────────┘

[잠깐 대화하기] 클릭 시:
- 타이머 정지
- 자유 대화 모드 (최대 3회)
- 대화 종료 후 게임 재개
```

**장점**:
- 게임 몰입도 유지
- 자연스러운 대화 흐름

**단점**:
- 게임 흐름 끊김
- 구현 복잡도 높음

---

### 1.3 EEVE LLM 프롬프트 설계

```python
# 티키타카 대화 모드용 시스템 프롬프트
CHAT_MODE_SYSTEM_PROMPT = """
당신은 23세 여자친구 '예리'입니다.

성격:
- 밝고 애교 많음
- 감정 표현이 풍부함
- 남자친구를 잘 챙김
- 센스 있고 재치있는 답변

대화 스타일:
- 반말 사용 (오빠~)
- 이모티콘 적절히 사용 (♡, ~, !)
- 2-3문장으로 간결하게 답변
- 남자친구 관점에서 따뜻한 조언

주제:
- 데이트 추천, 선물 추천, 일상 고민 상담
- 음식 추천, 패션 조언 등
- 게임이나 부적절한 내용은 거절

예시:
사용자: "데이트 코스 추천해줘"
예리: "오빠 취향이면 한강 야경은 어때? 요즘 날씨도 좋고~
      저녁 먹고 산책하면 분위기 완전 좋을 것 같아♡"
"""
```

---

### 1.4 우선순위 및 일정

| 항목 | MVP | Phase | 예상 기간 |
|------|-----|-------|-----------|
| 설계 | ❌ | Post-MVP | 1일 |
| 백엔드 API | ❌ | Post-MVP | 2일 |
| 프론트엔드 UI | ❌ | Post-MVP | 3일 |
| EEVE 프롬프트 | ❌ | Post-MVP | 1일 |
| 테스트 | ❌ | Post-MVP | 2일 |

**총 예상 기간**: 9일

---

## 2. 게임 설정 커스터마이징

### 2.1 컨셉

**핵심 아이디어**: 플레이어가 게임 난이도/시간을 조정

**사용 예시**:
- "30초는 너무 짧아! 1분 주면 안 돼?"
- "익스트림 모드로 도전해볼래!"

### 2.2 게임 모드 정의 (최종 확정)

```typescript
// lib/constants.ts (2025-11-07 업데이트)
export const GAME_MODES = {
  QUICK_DATE: {
    id: "quick_date",
    name: "짧은 데이트 ⏱️",
    description: "빠르고 긴장감 있는 데이트",
    turnLimits: { 1: 3, 2: 10, 3: 30 },
    icon: "⏱️",
  },
  LONG_DATE: {
    id: "long_date",
    name: "긴 데이트 💕",
    description: "여유롭게 충분히 생각할 시간을 드려요",
    turnLimits: { 1: 3, 2: 10, 3: 60 },
    icon: "💕",
  },
};
```

**변경 사항**:
- ❌ **EXTREME 모드 제거**: 너무 어려움, 사용자 경험 저하
- ❌ **CUSTOM 모드 제거**: MVP는 심플하게 (Post-MVP에서 재검토)
- ✅ **긴 데이트**: 마지막 턴만 60초로 연장 (첫 2턴은 동일 유지)

### 2.3 UI 구조

**설정 화면** (최종):
```
┌─────────────────────────────────────┐
│       데이트 시간 선택              │
├─────────────────────────────────────┤
│                                     │
│  ● 짧은 데이트 ⏱️                   │
│     3초 → 10초 → 30초               │
│     빠르고 긴장감 있는 데이트       │
│                                     │
│  ○ 긴 데이트 💕                     │
│     3초 → 10초 → 60초               │
│     여유롭게 충분히 생각할 시간     │
│                                     │
│  [게임 시작하기]                    │
└─────────────────────────────────────┘
```

**특징**:
- ✅ 선택지 2개 (심플)
- ✅ 첫 2턴은 동일 유지 (긴장감 유지)
- ✅ 마지막 턴만 차별화 (30초 vs 60초)

### 2.4 백엔드 수정

```python
# app/models/session.py
class SessionStartRequest(BaseModel):
    player_id: Optional[str] = None
    difficulty: Literal["easy", "medium", "hard"] = "medium"
    game_mode: Literal["normal", "relaxed", "extreme", "custom"] = "normal"
    custom_turn_limits: Optional[Dict[int, int]] = None  # 커스텀 모드용

# app/api/session.py
@router.post("/start")
async def start_session(request: SessionStartRequest):
    # 게임 모드에 따라 턴 시간 설정
    if request.game_mode == "custom":
        turn_limits = request.custom_turn_limits
    else:
        turn_limits = GAME_MODE_TURN_LIMITS[request.game_mode]

    # ... 세션 생성
```

### 2.5 우선순위 및 일정

| 항목 | MVP | Phase | 예상 기간 |
|------|-----|-------|-----------|
| 설계 | ✅ | Phase 8 | 0.5일 |
| 백엔드 수정 | ✅ | Phase 8 | 0.5일 |
| 프론트엔드 UI | ✅ | Phase 8 | 1일 |
| 테스트 | ✅ | Phase 8 | 0.5일 |

**총 예상 기간**: 2.5일

**MVP 포함**: ✅ Yes (Phase 8에 추가)

---

## 3. 기타 확장 아이디어

### 3.1 멀티 캐릭터 시스템

**컨셉**: 연령대별 다른 캐릭터

```typescript
const CHARACTERS = {
  "10대": { name: "지우", age: 17, tone: "활발하고 귀여운" },
  "20대": { name: "예리", age: 23, tone: "밝고 애교 많은" },
  "30대": { name: "수진", age: 31, tone: "성숙하고 차분한" },
  "40대+": { name: "미영", age: 42, tone: "우아하고 지적인" },
};
```

**우선순위**: Post-MVP (Phase 11+)

---

### 3.2 데이트 장소 광고 시스템

**컨셉**: Before 대사에 실제 장소 광고

```typescript
const SPONSORED_LOCATIONS = [
  {
    name: "스타벅스 강남점",
    dialogue: "{이름} 오빠~ 오늘 스타벅스에서 만나는 거지?",
  },
  {
    name: "롯데월드",
    dialogue: "오늘 롯데월드 가는 거 맞지? 기대된다~",
  },
];
```

**우선순위**: Post-MVP (Phase 12+)

---

## 4. 비용 고려사항

### 4.1 API 호출 비용 추정

| 기능 | 호출 빈도 | 예상 비용 (월 1000명 기준) |
|------|-----------|---------------------------|
| 기본 게임 | 턴당 1회 × 3턴 | 기준 (100%) |
| 티키타카 대화 | 메시지당 1회 × 10회 | +333% |
| 게임 설정 (여유) | 동일 | +0% |
| 게임 설정 (익스트림) | 동일 | +0% |

**결론**:
- 게임 설정: 비용 증가 없음 ✅
- 티키타카 대화: 대화 횟수 제한 필수 ⚠️

### 4.2 제한 전략

```typescript
// 티키타카 모드 제한
const CHAT_LIMITS = {
  FREE_USER: {
    maxTurnsPerSession: 5,      // 무료: 5회
    maxSessionsPerDay: 3,       // 하루 3회
  },
  PREMIUM_USER: {
    maxTurnsPerSession: 20,     // 유료: 20회
    maxSessionsPerDay: 999,     // 무제한
  },
};
```

---

## 5. 개발 우선순위 최종 정리

### MVP (필수)
1. ✅ 기본 게임 플로우
2. ✅ 3턴 시스템
3. ✅ 점수 계산
4. ✅ SNS 공유

### Phase 8 (게임 설정)
5. ⏳ 게임 모드 선택 (일반/여유/익스트림/커스텀)

### Post-MVP (추후 추가)
6. ⏳ 티키타카 대화 모드 (별도 메뉴)
7. ⏳ 멀티 캐릭터 시스템
8. ⏳ 데이트 장소 광고

---

## 6. 다음 단계

### 즉시 작업
- **없음** (MVP 집중)

### Phase 8 (게임 설정 추가 시)
```
1. lib/constants.ts에 GAME_MODES 추가
2. 설정 화면 UI 구현
3. 백엔드 SessionStartRequest 수정
4. 테스트
```

### Post-MVP (티키타카 모드)
```
1. docs/11_Chat_Mode_Design.md 작성
2. 백엔드 chat API 구현
3. 프론트엔드 대화 화면 구현
4. EEVE 프롬프트 최적화
5. 비용 제한 로직 구현
```

---

**작성일**: 2025-11-07
**다음 리뷰**: MVP 완료 후
