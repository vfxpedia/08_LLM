# 01_Game_Structure.md

## 1. 개요

본 문서는 ‘예리는 못 말려’ 프로젝트의 **게임 전체 구조**를 정의한다. 오프닝에서부터 엔딩까지의 플레이 흐름, 턴별 시간 구조, 예리의 감정 변화, 콤보 시스템, 그리고 점수 연동 로직까지 포함한다.

---

## 2. 핵심 플레이 플로우

### 2.0 시작 화면 (Start Screen) 🆕

- **UI 구성**:
  - "예리는 못 말려" 타이틀
  - "예리랑 데이트 시작하기 💕" 버튼
  - 플레이어 정보 입력 폼
    - 이름 (닉네임) 입력
    - 연령대 선택 (10대 / 20대 / 30대 / 40대+)

- **목적**:
  - 플레이어 맞춤 경험 제공
  - SNS 공유 시 개인화된 결과 카드 생성
  - 추후 연령대별 캐릭터 확장 대비 (MVP: 20대 예리만)

---

### 2.1 Before 인지 단계 (Pre-Game Introduction) 🆕

**스토리 시작**

1. **예리 등장 (Before 이미지)**
   - Before 이미지 전체 화면으로 표시
   - 밝고 사랑스러운 BGM 시작

2. **인사 대사 (TTS)**
   - 패턴 1: `"{플레이어 이름} 오빠~ 왜 이렇게 빨리 왔어? 예리 아직 준비 다 못했는데... 나 얼른 준비하고 올게~~~"`
   - 패턴 2: `"{플레이어 이름} 오빠~ 오늘 {장소}로 데이트 가는 거지? 나 금방 준비하고 올게~"` (추후 LLM 생성)
   - 패턴 3: `"{플레이어 이름} 오빠, 기다렸지? 조금만 기다려줘~♡"`

3. **Before 이미지 인지 시간**
   - 5~10초간 Before 이미지 노출
   - 플레이어가 예리의 초기 모습을 충분히 인지할 시간 제공
   - [스킵 버튼] 옵션 제공 (빠른 플레이어용)

4. **화면 전환 효과**
   - 암전 또는 페이드 효과
   - 준비 완료 사운드 (예: 문 열리는 소리)

---

### 2.2 게임 시작 (Game Start)

1. **After 등장**
   - After 이미지로 전환
   - 예리의 대사(TTS): `"근데 {플레이어 이름} 오빠, 나 뭐 바뀐 거 없어?"`

2. **UI 활성화**
   - Before/After 이미지 좌우 분할 표시 (또는 버튼으로 전환 가능)
   - 상단 타임라인 활성화
   - 1턴 시작 (3초 카운트다운)

3. **플레이 방식**
   - 플레이어는 예리의 변화된 부분(5~10개 중 일부)을 입력:
     - **텍스트 입력**: 답변 입력창 사용
     - **음성 입력**: 🎤 녹음 버튼 사용 (STT 변환)
     - **힌트 사용**: 💡 Hint 버튼 (턴당 1회, 점수 감점)

4. **실시간 반응**
   - 예리의 반응은 턴마다 실시간으로 업데이트
   - 감정 상태(표정·대사)가 동적으로 변화
   - 정답 시: 💬 말풍선 팝업 (팡! 효과)
   - 콤보 발생 시: 감정 단계 상승 (S0 → S1 → S4)

---

## 3. 턴 구조 및 타임라인

| 턴 | 시간 | 주요 특징 | 예리의 감정 상태 | 대사 예시 |
|-----|--------|------------------|------------------|------------------|
| 1턴 | 3초 | 의도적으로 짧은 시간. 긴장감 유발. | 기대 + 장난 | “오빠~~ 3초 안에 맞춰야 해~!” |
| 2턴 | 10초 | 실질적인 퀴즈 진행. | 초조 + 집중 | “오빠, 진짜 나 뭐 바뀐지 몰라? 이번엔 꼭 맞춰야 해~!” |
| 3턴 | 30초 | 마지막 기회, 예리의 감정 변화가 두드러짐. | 실망 → 감동 | “이번이 마지막이야... 맞추면 용서해줄게♡” |

> ⚙️ 타이머는 상단 Progress Bar로 표시되며, 시간이 줄어들수록 색상이 붉게 변한다.

---

## 4. 실시간 감정 변화 (표정·대사 로직)

예리의 표정은 **시간, 정답 개수, 콤보 상태**에 따라 5단계로 변화한다.

| 상태 코드 | 감정 단계 | 트리거 조건 | 예시 대사 |
|-------------|--------------|----------------|----------------|
| S0 | 기본 미소 | 시작 시 | “오빠~ 잘 봐야 해~ 오늘은 특별하니까!” |
| S1 | 기대감 상승 | 첫 정답 맞춤 or 콤보 1회 | “오빠! 눈썰미 좋아졌네~?” |
| S2 | 초조함 | 오답 연속 or 시간 절반 경과 | “아직도 몰라? 나 삐질 거야...” |
| S3 | 실망 | 마지막 턴 진입 전 오답 | “하아... 진짜 실망이야...” |
| S4 | 감동/행복 | 정답 완전 달성 or 높은 감정 점수 | “오빠 최고야♡ 역시 내 남자야~!” |

> 표정 변화는 LLM 제어가 아닌, 클라이언트 측 로직(시간·정답 수·콤보)에 의해 자동 전환된다.

---

## 5. 콤보 시스템 (Combo Mechanic)

- 플레이어가 연속으로 변화된 포인트를 맞출 경우 콤보가 발생한다.
- 최대 **3콤보**까지 인정.

| 콤보 수 | 추가 점수 | 예리 반응 |
|-----------|-------------|-------------|
| 1콤보 | +2점 | “오~ 오빠 감각 있는데?” |
| 2콤보 | +4점 | “헐, 두 개 연속이야? 나 설레는데...?” |
| 3콤보 | +6점 | “오빠... 진짜 나 좋아하지?♡” |

- 콤보는 **관찰력 점수** 및 **감정 점수**에 소폭 가산된다.
- 연속 정답 입력은 텍스트·음성 모두 인식.

---

## 6. 엔딩 분기 및 SNS 공유 🆕

### 6.1 엔딩 분기 (100점 기준)

| 점수 범위 | 엔딩 타입 | 예리 반응 |
|--------------|----------------|----------------|
| 80~100점 | 사랑꾼 엔딩 | "오빠 너무 멋져... 사랑해♡" |
| 50~79점 | 귀엽게 삐진 엔딩 | "흠... 그래도 오늘은 봐줄게~" |
| 0~49점 | 이별 엔딩 | "오빠... 우리 이제 그만하자..." |

> 엔딩은 점수 외에도 감정센스(EEVE 분석값)에 따라 미묘한 변주를 가질 수 있다.

### 6.2 SNS 공유 카드

**공유 카드 구조**
```
┌─────────────────────────────────┐
│   💕 예리는 못 말려 💕          │
├─────────────────────────────────┤
│                                 │
│      🧍‍♀️ [예리 이미지]          │
│                                 │
│   "{플레이어 이름}님의          │
│      연애 센스 점수"            │
│                                 │
│         ⭐ 75점 ⭐              │
│                                 │
│   ────────────────────          │
│   감정센스: 45점 (60%)          │
│   관찰력:   19점 (25%)          │
│   순발력:   11점 (15%)          │
│   ────────────────────          │
│                                 │
│   [나도 도전하기 →]             │
└─────────────────────────────────┘
```

**공유 문구 템플릿**
- 80~100점: `"{이름}님은 완벽한 연애 센스! 예리가 반했어요♡"`
- 50~79점: `"{이름}님은 귀여운 연애 센스~ 예리가 삐졌어요!"`
- 0~49점: `"{이름}님은 아직 연습이 필요해요... 다시 도전해보세요!"`

**공유 데이터**
- ✅ 플레이어 이름 (개인화)
- ✅ 최종 점수
- ✅ 점수 상세 (감정센스/관찰력/순발력)
- ❌ 연령대 정보 제외 (프라이버시 고려)

---

## 7. UI 디자인 구조 (Based on ui_reference_layout.png) 🆕

### 7.1 메인 게임 화면 레이아웃

```
┌─────────────────────────────────────────┐
│     오빠😍 나 뭐 달라진 거 없어?         │  ← 타이틀 (핑크 배경)
├─────────────────────────────────────────┤
│  30 [████████████████░░░░░░] 😊 30      │  ← Progress Bar + 감정 아이콘
│     (시간 감소 시 아이콘이 왼쪽 이동)    │
├──────────────────┬──────────────────────┤
│     BEFORE       │       AFTER          │  ← 이미지 라벨
│                  │                      │
│      🧍‍♀️         │        🧍‍♀️           │  ← Before/After 이미지
│   (검은 머리)     │     (핑크 머리)       │
│                  │                      │
├──────────────────┴──────────────────────┤
│  💬 "오빠~ 머리 색깔 바꿨어?"           │  ← 예리 대사 박스 (말풍선)
├─────────────────────────────────────────┤
│          [답변 입력창]                  │  ← 입력 영역
├─────────────────────────────────────────┤
│  [🎤 녹음]   [💡 Hint]   [📝 입력]      │  ← 3버튼 레이아웃
└─────────────────────────────────────────┘
```

### 7.2 UI 컴포넌트 상세

#### 상단 헤더
- **타이틀**: "오빠😍 나 뭐 달라진 거 없어?" (고정)
- **Progress Bar**:
  - 좌측 숫자: 시작 시간 (30초)
  - 우측 숫자: 남은 시간 (실시간 카운트다운)
  - 진행 바 색상: 초록 → 노랑 → 빨강 (시간 감소)
  - 감정 아이콘: Progress Bar 위에서 좌측으로 이동 (시간 연동)

#### Before/After 이미지
- **좌우 분할 레이아웃**
- **라벨**: 각 이미지 상단에 "BEFORE" / "AFTER" 텍스트
- **비율**: 1:1 (동일 크기)
- **전환 옵션**: 버튼 클릭 시 단일 이미지 모드 ↔ 비교 모드

#### 대사 박스
- **위치**: 이미지 하단
- **스타일**: 💬 말풍선 형태 (핑크 배경)
- **내용**: 예리의 반응 대사 (정답/오답/콤보 시 변화)
- **애니메이션**: 정답 시 "팡!" 터지는 효과

#### 입력 영역
- **답변 입력창**: 텍스트 입력 필드
- **3버튼 레이아웃**:
  - 🎤 **녹음**: STT 음성 입력 (추후 구현)
  - 💡 **Hint**: 힌트 제공 (턴당 1회, 점수 -5점)
  - 📝 **입력**: 텍스트 답변 전송

### 7.3 UI 인터랙션

#### Progress Bar + 감정 아이콘 이동
```
시작 (30초):  [████████████████████] 😊
                                   ↑
                                여기서 시작

진행 (15초):  [██████████░░░░░░░░░░] 😐
                        ↑
                  중간으로 이동

종료 (0초):   [░░░░░░░░░░░░░░░░░░░░] 😢
              ↑
        끝까지 이동
```

#### 감정 아이콘 변화 조건
- **시간 기반**: S0 (시작) → S2 (절반) → S3 (종료)
- **콤보 기반**: S0 → S1 (1콤보) → S4 (3콤보)
- **오답 기반**: S1 → S2 → S3

#### 말풍선 팝업 시스템
```javascript
// 정답 시
if (isCorrect && combo === 1) {
  showPopup("오~ 오빠 감각 있는데?"); // S0 → S1
} else if (isCorrect && combo === 2) {
  showPopup("헐, 두 개 연속이야?"); // S1
} else if (isCorrect && combo === 3) {
  showPopup("오빠... 진짜 나 좋아하지?♡"); // S1 → S4
}

// 오답 시
if (!isCorrect) {
  showPopup("에이~ 그건 아닌데..."); // 감정 하락
}
```

### 7.4 컬러 팔레트 (핑크/파스텔 테마)

| 요소 | 컬러 |
|------|------|
| 배경 | #FFF0F5 (라벤더 블러쉬) |
| 타이틀 바 | #FFB6C1 (라이트 핑크) |
| Progress Bar (진행) | #FF69B4 (핫 핑크) |
| Progress Bar (남음) | #E6E6FA (라벤더) |
| 버튼 (Primary) | #FF1493 (딥 핑크) |
| 버튼 (Secondary) | #FFC0CB (핑크) |
| 텍스트 | #333333 (다크 그레이) |
| 말풍선 배경 | #FFEEF8 (연핑크) |

### 7.5 반응형 디자인

- **모바일 우선**: 세로형 레이아웃 (아이폰 스타일)
- **데스크탑**: Before/After 좌우 분할 유지
- **타블렛**: Before/After 상하 분할 옵션

---

## 8. 다음 단계

- **02_Score_System_Detail.md:** 콤보·표정 변화 점수 반영 및 100점 스케일 계산 로직 명시.
- **03_Character_Design.md:** 예리 표정·감정 단계별 이미지 및 음성 톤 정의.
- **04_LLM_Prompt_Design.md:** 턴·콤보·감정 상태별 대사 프롬프트 구조 설계.

---

## 8. 부록: 핵심 기술 트리거 요약

| 트리거 | 영향 요소 | 설명 |
|-----------|----------------|----------------|
| 정답 수 | 관찰력 점수 | 시각적 차이 감지 정확도 평가 |
| 감정 표현 | 감정 센스 점수 | EEVE 감정 분석 모델에 따른 공감도 반영 |
| 시간 | 순발력 점수 | 턴별 남은 시간에 따른 가중치 계산 |
| 콤보 | 보너스 점수 | 연속 정답 시 추가 가산 |
| 표정 단계 | UI 반응 | 감정 상태별 예리 표정 전환 |

---

이 문서는 100점 기반 구조, 3턴 타임라인, 예리의 감정 변화 및 콤보 시스템을 포함한 최신 설계를 반영한다.

